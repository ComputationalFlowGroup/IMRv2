% file f_compute_perturb_coeffs.m
% brief contains function f_compute_perturb_coeffs

% brief This function computes the coefficients for the linearized bubble
% surface perturbation evolution equation
function [eta, xi] = f_compute_perturb_coeffs(R, U, Rddot, n, chi, Ro, We, Re, Ca, Ca2, alpha)

    lam = R/Ro;
    if isequal(Ca, Inf)
        eta = 3.*U./R+2.*(n+1).*(n+2)./(Re.*R^2);
        xi = -(n-1).*Rddot./R+4.*(n-1).*(n+1).*1./Re.*U./R^3+(n-1).*(n+ ...
              1).*(n+2)./(2.*We.*R^3);
        xi = xi'; eta = eta';
    else

        % pre allocattion for only inertial case
        eta = 4.*(5+2.*n).*U./((4+n).*R);
        xi = 6.*(n+2)./(n+4).*U^2./R^2+(8+n-n.^2).*Rddot./((n+4).*R);


        for i = 1:length(n)
            % --- First-order elastic term (coefficient of G) ---
            elast = -(1 ./ (lam^6 .* (3 + n(i)).* Ro^2)) .* ( ...
                -4 .* chi(i).* lam^4 .* hyp2f1(2./3, (3 + n(i))./3, (6 + n(i))./3, 1 - 1./lam^3) + ...
                (1 + n(i)) .* (2 .* (3 + n(i)) .* (1 + 2 .* lam^3 - lam^6 + n(i)) - ...
                lam .* (8 .* lam^3 - 2 .* lam^6 .* (4 + n(i)) + n(i) .* (4 + n(i))) .* ...
                hyp2f1(-1./3, (3 + n(i))./3, (6 + n(i))./3, 1 - 1./lam^3) + ...
                lam .* (-2 .* lam^6 + n(i) + lam^3 .* (2 - n(i) + n(i)^2)) .* ...
                hyp2f1(2./3, (3 + n(i))./3, (6 + n(i))./3, 1 - 1./lam^3)));

            % --- Second-order elastic term (coefficient of α.*G) ---
            sselast = (1./(81.*lam^10.*Ro^2)).*(1+n(i)).*(162.*(-1+lam^3)^2.*(3+2.*lam^3-3.*lam^4+2.*lam^6) ...
                -162.*(2-3.*lam^4+lam^6).*(2+n(i))+(1./lam).*(-1.*((54.*gamma(4+n(i)./3).*((1+n(i)).*(3+n(i)).*gamma((6+n(i))./3).*(2.*lam^3.*(14+ ...
                n(i)).*((-3+n(i)).*n(i)+lam^9.*(6+n(i)).*(9+n(i))+lam^12.*(6+n(i)).*(9+n(i))-3.*lam^6.*(-9+n(i).*(12+n(i)))+ ...
                3.*lam^3.*(9+n(i).*(18+n(i)))).*hyp2f1(-(2./3),4+n(i)./3,5+n(i)./3,1-1./lam^3)+3.*lam^3.*(9+ ...
                n(i)).*(13+n(i)).*(3.*lam^6.*(-2+n(i))+n(i)-5.*lam^3.*n(i)-lam^9.*(6+n(i))).*hyp2f1(-(1./3),4+n(i)./3,5+n(i)./3,1-1./lam^3)+ ...
                2.*(-2.*lam^12.*(6+n(i)).*(9+n(i))-2.*lam^15.*(6+n(i)).*(9+n(i))-lam^9.*(1+n(i)).*(6+n(i)).*(9+n(i))+n(i).*(141+n(i).*(22+n(i)))- ...
                lam^3.*n(i).*(417+n(i).*(68+3.*n(i)))+3.*lam^6.*(-18+n(i).*(105+n(i).*(20+n(i))))).*hyp2f1(1./3,4+n(i)./3,5+n(i)./3,1-1./lam^3)- ...
                3.*(9+n(i)).*(-lam^12.*(6+n(i))-lam^9.*(1+n(i)).*(6+n(i))+n(i).*(10+n(i))+lam^6.*n(i).*(25+3.*n(i))-lam^3.*n(i).*(29+3.*n(i))).*hyp2f1(2./3,4+n(i)./3,5+n(i)./3,1-1./lam^3))+...
                2.*chi(i).*(lam^3.*(14+n(i)).*(-2.*lam^9.*(3+n(i)).*(6+n(i)).*(9+n(i))+2.*(8+n(i)).*(9+n(i).*(7+n(i)))-2.*lam^3.*(25+3.*n(i)).*(9+n(i).*(7+n(i)))+ ...
                lam^6.*(468+n(i).*(427+n(i).*(95+6.*n(i))))).*gamma((6+n(i))./3).*hyp2f1(-(2./3),4+n(i)./3,5+n(i)./3,1-1./lam^3)-2.*(792+787.*n(i)+ ...
                230.*n(i)^2+26.*n(i)^3+n(i)^4-2.*lam^12.*(3+n(i)).*(6+n(i)).*(9+n(i))-lam^9.*(2+n(i)).*(3+n(i)).*(6+n(i)).*(9+n(i))-lam^3.*(8+n(i)).*(31+3.*n(i)).*(9+ ...
                n(i).*(7+n(i)))+lam^6.*(9+n(i).*(7+n(i))).*(214+3.*n(i).*(17+n(i)))).*gamma((6+n(i))./3).*hyp2f1(1./3,4+n(i)./3,5+n(i)./3,1-1./lam^3)+ ...
                81.*lam^9.*gamma(5+n(i)./3).*hyp2f1(2./3,(3+n(i))./3,(6+n(i))./3,1-1./lam^3))))./((1+n(i)).*(3+n(i)).*(6+n(i)).*(9+n(i)).*gamma(5+n(i)./3).*gamma((6+n(i))./3)))+ ...
                (1./((3+n(i)).*(12+n(i)))).*162.*lam^3.*(2.*lam^3+n(i)).*((2+lam^6).*(3+n(i)).*(14+n(i)).*hyp2f1(-(2./3),4+n(i)./3,5+n(i)./3,1-1./lam^3)- ...
                2.*(2+lam^6).*(3+n(i)).*hyp2f1(1./3,4+n(i)./3,5+n(i)./3,1-1./lam^3)+3.*(12+n(i)).*(-((1+n(i)).*hyp2f1(2./3,(3+n(i))./3,(6+n(i))./3,1-1./lam^3))- ...
                2.*hyp2f1(5./3,(3+n(i))./3,(6+n(i))./3,1-1./lam^3)))-n(i).*gamma(1+n(i)./3).*((1./gamma(5+n(i)./3)).*lam^3.*(14+n(i)).*(18.*(1+7.*lam^3)+ ...
                2.*lam^9.*(1+n(i)).*(3+n(i)).*(6+n(i)).*(9+n(i))-n(i).*(187+n(i).*(146+n(i).*(31+2.*n(i))))+2.*lam^3.*n(i).*(367+n(i).*(246+n(i).*(49+3.*n(i))))- ...
                lam^6.*(-180+n(i).*(565+n(i).*(478+99.*n(i)+6.*n(i)^2)))).*hyp2f1(-(2./3),4+n(i)./3,5+n(i)./3,1-1./lam^3)-(1./gamma(5+n(i)./3)).*2.*(18.*(-8+ ...
                25.*lam^3)+2.*lam^12.*(1+n(i)).*(3+n(i)).*(6+n(i)).*(9+n(i))+lam^9.*(1+n(i)).*(2+n(i)).*(3+n(i)).*(6+n(i)).*(9+n(i))+lam^3.*n(i).*(8+n(i)).*(445+n(i).*(291+n(i).*(55+3.*n(i))))- ...
                n(i).*(1249+n(i).*(973+n(i).*(254+n(i).*(27+n(i)))))-lam^6.*(306+n(i).*(3013+n(i).*(2427+n(i).*(664+3.*n(i).*(25+n(i))))))).*hyp2f1(1./3,4+n(i)./3,5+n(i)./3,1-1./lam^3)- ...
                (1./((4+n(i)).*(7+n(i)).*gamma((6+n(i))./3))).*81.*lam^3.*((12+19.*n(i)+8.*n(i)^2+n(i)^3+4.*lam^3.*(1+n(i)).*(3+n(i))+lam^6.*(5+n(i)).*(8+n(i).*(7+n(i)))).*hyp2f1(2./3,(3+n(i))./3,(6+n(i))./3,1-1./lam^3)+...
                2.*(3+n(i)).*(4+4.*lam^3+n(i)).*hyp2f1(5./3,(3+n(i))./3,(6+n(i))./3,1-1./lam^3)))));

            % --- MR elastic term (coefficient of G2) ---
            MRelast = -(1./(lam.^11.*(3+n(i)).*(6+n(i)).*(9+n(i)).*(12+ ...
                n(i)).*Ro.^2)).*(-4.*chi(i).*(lam.^3.*(14+n(i)).*(16-50.*lam.^3+ ...
                88.*lam.^6+(2-6.*lam.^3+19.*lam.^6).*n(i)+ ...
                lam.^6.*n(i).^2).*hyp2f1(-(2/3),4+n(i)/3,5+n(i)/3,1-1/lam.^3)- ...
                2.*(88-248.*lam.^3+214.*lam.^6+(19-55.*lam.^3+51.*lam.^6).*n(i)+ ...
                (1-3.*lam.^3+3.*lam.^6).*n(i).^2).*hyp2f1(1/3,4+n(i)/3,5+n(i)/3,1-1/lam.^3))+ ...
                (1+n(i)).*(2.*lam.^7.*(1+2.*lam.^9+lam.^6.*(-1+n(i))).*(1944+1350.*n(i)+ ...
                315.*n(i).^2+30.*n(i).^3+n(i).^4)+lam.^3.*(14+n(i)).*(324.*lam.^9.*(1+ ...
                lam.^3-2.*lam.^6)-2.*(136-425.*lam.^3+424.*lam.^6-342.*lam.^9+63.*lam.^12+ ...
                198.*lam.^15).*n(i)-(282-877.*lam.^3+886.*lam.^6-495.*lam.^9+162.*lam.^12+ ...
                72.*lam.^15).*n(i).^2-(111-343.*lam.^3+351.*lam.^6-155.*lam.^9+34.*lam.^12+ ...
                4.*lam.^15).*n(i).^3+(-18+55.*lam.^3-56.*lam.^6+21.*lam.^9- ...
                2.*lam.^12).*n(i).^4+(-1+lam.^3).^3.*n(i).^5).*hyp2f1(-(2/3),4+n(i)/3,5+n(i)/3,1-1/lam.^3)+ ...
                (648.*lam.^12.*(-1-lam.^3+2.*lam.^6)+4.*(748-2108.*lam.^3+ ...
                1819.*lam.^6-324.*lam.^9-342.*lam.^12+63.*lam.^15+198.*lam.^18).*n(i)+ ...
                2.*(1687-4779.*lam.^3+4184.*lam.^6-801.*lam.^9-495.*lam.^12+162.*lam.^15+ ...
                72.*lam.^18).*n(i).^2+(1503-4287.*lam.^3+3823.*lam.^6-801.*lam.^9- ...
                310.*lam.^12+68.*lam.^15+8.*lam.^18).*n(i).^3+(309-891.*lam.^3+ ...
                817.*lam.^6-197.*lam.^9-42.*lam.^12+4.*lam.^15).*n(i).^4-(-1+ ...
                lam.^3).^3.*(29+2.*lam.^3).*n(i).^5-(-1+ ...
                lam.^3).^3.*n(i).^6).*hyp2f1(1/3,4+n(i)/3,5+n(i)/3,1-1/lam.^3)));

            % --- Viscous term (coefficient of μ) for eta ---
            visceta = -2.*(6+n(i).*(10+n(i).*(5+n(i)))-2.*chi(i))./((3+n(i)).*R^2);

            % --- Viscous term (coefficient of μ) for xi ---
            viscxi = -(n(i).*(n(i)+1).*(7.*n(i)+12).*U-16.*U.*chi(i))./((6+n(i)).*R^3);

            % --- Surface tension term (coefficient of γ) ---
            surften = -((n(i)+1).*(n(i)-1).*(n(i)+2)./R^3);

            % Correcting coefficients
            xi(i) = xi(i) - 1/Ca*elast - alpha/Ca*sselast - 1/Ca2*MRelast - 1/(2*We)*surften - 1/Re*viscxi;
            eta(i) = eta(i) - 1/Re*visceta;
        end
        xi = xi'; eta = eta';
    end
end
